// Copyright 2025 The ODML Authors.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//      http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

// TODO(b/445163709): Remove this module once litert_lm publishes a pypi
// package.

syntax = "proto3";

package litert.lm.proto;

import "litert/python/internal/token.proto";

// The model type of the LLM.
message LlmModelType {
  // The model type here are predefined model types that LiteRT-LM team
  // supports.
  oneof model_type {
    GenericModel generic_model = 1;
    Gemma3N gemma3n = 2;
    FunctionGemma function_gemma = 3;
    Gemma3 gemma3 = 4;
    Qwen3 qwen3 = 5;
    Qwen2p5 qwen2p5 = 7;
  }
  reserved 6;
  reserved 8;
}

// The default model type for the generic model.
message GenericModel {
  // The model role to use for the model.
  optional string model_role = 1;
  // If true, force the content from the model to be a string instead of an
  // array. Some legacy templates only support string content.
  optional bool force_string_content = 2;
}

// Google's Gemma3N model.
message Gemma3N {
  // Vision modality.
  // The start of image token indicates the start of image in the prompt.
  TokenUnion start_of_image_token = 1;
  // The end of image token indicates the end of image in the prompt.
  TokenUnion end_of_image_token = 2;
  // The height of the image tensor that image preprocessor should resize to.
  int32 image_tensor_height = 3;
  // The width of the image tensor that image preprocessor should resize to.
  int32 image_tensor_width = 4;

  // Audio modality.
  // The start of audio token indicates the start of audio in the prompt.
  TokenUnion start_of_audio_token = 5;
  // The end of audio token indicates the end of audio in the prompt.
  TokenUnion end_of_audio_token = 6;
}

// The constraint mode when constrained decoding is enabled.
enum ConstraintMode {
  CONSTRAINT_MODE_UNSPECIFIED = 0;
  // Both function call and text output are allowed.
  CONSTRAINT_MODE_TEXT_AND_OR = 1;
  // Only function call is allowed.
  CONSTRAINT_MODE_FUNCTION_CALL_ONLY = 2;
}

// Google's Function Gemma model.
message FunctionGemma {
  reserved 1, 2, 3, 4;

  // Options for tool calling.
  // Signifies the beginning of a tool call.
  string code_fence_start = 5;
  // Signifies the end of tool call.
  string code_fence_end = 6;
  // The syntax type of the tool call.
  string syntax_type = 7;
  // Whether to escape the fence strings for regex matching.
  bool escape_fence_strings = 8;
  // An optional regex to match each line of the tool code block.
  string tool_code_regex = 9;
  // The open quote for string arguments.
  string open_quote = 10;
  // The close quote for string arguments.
  string close_quote = 11;
  // Signifies the start of function response.
  string function_response_start = 12;
  // Whether to use the chat template for applying FC format.
  bool use_template_for_fc_format = 13;
  // The constraint mode when constrained decoding is enabled.
  ConstraintMode constraint_mode = 14;
}

// Google's Gemma3 model.
message Gemma3 {
  // Vision modality.
  // The start of image token indicates the start of image in the prompt.
  TokenUnion start_of_image_token = 1;
  // The end of image token indicates the end of image in the prompt.
  TokenUnion end_of_image_token = 2;
  // The height of the image tensor that image preprocessor should resize to.
  int32 image_tensor_height = 3;
  // The width of the image tensor that image preprocessor should resize to.
  int32 image_tensor_width = 4;
}

// Qwen3 model.
message Qwen3 {
  // Options for tool calling.
  // Signifies the beginning of a tool call.
  optional string code_fence_start = 1;
  // Signifies the end of tool call.
  optional string code_fence_end = 2;
  // Whether to escape the fence strings for regex matching.
  optional bool escape_fence_strings = 3;
  // An optional regex to match each line of the tool code block.
  optional string tool_code_regex = 4;
}

// Qwen2.5 model.
message Qwen2p5 {
  // Options for tool calling.
  // Signifies the beginning of a tool call.
  optional string code_fence_start = 1;
  // Signifies the end of tool call.
  optional string code_fence_end = 2;
  // Whether to escape the fence strings for regex matching.
  optional bool escape_fence_strings = 3;
  // An optional regex to match each line of the tool code block.
  optional string tool_code_regex = 4;
}
